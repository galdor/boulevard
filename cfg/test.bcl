logger {
  terminal {
  }

  debug_level 1
}

acme {
  datastore_path "/tmp/boulevard/acme"
  contact "bob@example.com"

  http_challenge_solver {
    upstream_uri "http://localhost:8080"
  }

  pebble true
}

control_api {
  path "/tmp/boulevard.sock"
}

http_server "frontend" {
  listener {
    address ":8080"
  }

  listener {
    address ":4430"

    tls {
      domains "localhost"
    }
  }

  handler {
    match "/hello"
    reply 200 "hello"
  }

  # Authentication tests
  handler {
    match "/auth/basic/credentials"

    authentication {
      basic {
        user "bob" "2c26b46b68ffc68ff99b453c1d30413413422d706483bfa0f98a5e886266e7ae"
        user "alice" "fcde2b2edba56bf408601fb721fe9b5c338d10ee429ea04fae5511b68fbf8fb9"
      }
    }

    reply 200
  }

  handler {
    match "/auth/global"
    reply 200
  }

  handler {
    match "/auth/basic/credential-file"

    authentication {
      basic {
        user_file_path "test/basic-credentials.txt"
      }
    }

    reply 200
  }

  handler {
    match "/auth/bearer/tokens"

    authentication {
      bearer {
        token "2c26b46b68ffc68ff99b453c1d30413413422d706483bfa0f98a5e886266e7ae"
        token "fcde2b2edba56bf408601fb721fe9b5c338d10ee429ea04fae5511b68fbf8fb9"
      }
    }

    reply 200
  }

  handler {
    match "/auth/bearer/token-file"

    authentication {
      bearer {
        token_file_path "test/bearer-tokens.txt"
      }
    }

    reply 200
  }

  # Nested handler tests
  handler {
    match "/nested/"
    reply 200 "default"

    handler {
      match "/nested/foo"
      reply 200 "foo"
    }

    handler {
      match "bar/"

      authentication {
        bearer {
          token "2c26b46b68ffc68ff99b453c1d30413413422d706483bfa0f98a5e886266e7ae"
        }
      }

      reply 200 "bar"

      handler {
        match "x"
        reply 200 "x"
      }

      handler {
        match "/nested/bar/y"
        reply 200 "y"
      }
    }
  }

  # Reverse proxy tests
  handler {
    match "/nginx/"
    reverse_proxy "http://localhost:9002"
  }

  handler {
    match "/websocket"
    reverse_proxy "http://localhost:9003"
  }
}
